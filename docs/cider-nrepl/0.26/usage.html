<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Usage :: CIDER Docs</title>
    <link rel="canonical" href="https://docs.cider.mx/cider-nrepl/latest/usage.html">
    <link rel="prev" href="index.html">
    <link rel="next" href="internals.html">
    <meta name="generator" content="Antora 3.0.0">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="stylesheet" href="../../_/css/site-extra.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@docsearch/css@alpha">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-140176314-1"></script>
    <script>function gtag(){dataLayer.push(arguments)};window.dataLayer=window.dataLayer||[];gtag('js',new Date());gtag('config','UA-140176314-1')</script>
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header" role="banner">
  <nav class="navbar">
    <div class="navbar-brand">
      <div class="navbar-item">
        <a href="https://cider.mx">CIDER</a>
        <span class="separator">//</span>
        <a href="https://docs.cider.mx">Docs</a>
      </div>
      <div class="navbar-item">
        <input id="search-input" type="text" placeholder="Search docs">
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Projects</a>
          <div class="navbar-dropdown">
              <a class="navbar-item" href="https://github.com/clojure-emacs/cider">CIDER</a>
              <a class="navbar-item" href="https://github.com/clojure-emacs/cider-nrepl">CIDER nREPL</a>
              <a class="navbar-item" href="https://github.com/clojure-emacs/orchard">Orchard</a>
              <a class="navbar-item" href="https://github.com/clojure-emacs/clojure-mode">clojure-mode</a>
          </div>
        </div>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">Community</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="/cider/about/support.html">Support</a>
            <a class="navbar-item" href="/cider/contributing.html">Contributing</a>
            <a class="navbar-item" href="https://opencollective.com/cider">Open Collective</a>
          </div>
        </div>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="cider-nrepl" data-version="0.26">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html">CIDER nREPL</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="index.html">Home</a>
  </li>
  <li class="nav-item is-current-page" data-depth="1">
    <a class="nav-link" href="usage.html">Usage</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="internals.html">Understanding the Internals</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">nREPL API</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="nrepl-api/supplied_middleware.html">Supplied Middleware</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="nrepl-api/ops.html">Supplied Ops</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="hacking.html">Hacking on CIDER nREPL</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="compatibility.html">Compatibility</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="release_policy.html">Release Policy</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="faq.html">FAQ</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">About</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="about/history.html">History</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="about/changelog.html">Changelog</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="about/license.html">License</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">CIDER nREPL</span>
    <span class="version">0.26</span>
  </div>
  <ul class="components">
    <li class="component">
      <a class="title" href="../../cider/index.html">CIDER</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../../cider/index.html">master</a>
        </li>
        <li class="version">
          <a href="../../cider/1.2/index.html">1.2</a>
        </li>
        <li class="version">
          <a href="../../cider/1.1/index.html">1.1</a>
        </li>
        <li class="version">
          <a href="../../cider/1.0/index.html">1.0</a>
        </li>
      </ul>
    </li>
    <li class="component is-current">
      <a class="title" href="../latest/index.html">CIDER nREPL</a>
      <ul class="versions">
        <li class="version is-latest">
          <a href="../latest/index.html">0.28</a>
        </li>
        <li class="version is-current">
          <a href="index.html">0.26</a>
        </li>
        <li class="version">
          <a href="../0.25/index.html">0.25</a>
        </li>
        <li class="version">
          <a href="../0.24/index.html">0.24</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../../cider/index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">CIDER nREPL</a></li>
    <li><a href="usage.html">Usage</a></li>
  </ul>
</nav>
<div class="page-versions">
  <button class="version-menu-toggle" title="Show other versions of page">0.26</button>
  <div class="version-menu">
    <a class="version" href="../latest/usage.html">0.28</a>
    <a class="version is-current" href="usage.html">0.26</a>
    <a class="version" href="../0.25/usage.html">0.25</a>
    <a class="version" href="../0.24/usage.html">0.24</a>
  </div>
</div>
  <div class="edit-this-page"><a href="https://github.com/clojure-emacs/cider-nrepl/blob/v0.26.0/doc/modules/ROOT/pages/usage.adoc">Edit this Page</a></div>
  </div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Usage</h1>
<div class="sect1">
<h2 id="prerequisites"><a class="anchor" href="#prerequisites"></a>Prerequisites</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>cider-nrepl</code> supports only Clojure(Script) 1.8+ and Java 8+.</p>
</div>
<div class="paragraph">
<p>Leiningen users will need to have version 2.8.3 or newer installed.
Boot users will need to have version 2.8.2 or newer installed.</p>
</div>
</div>
</div>
<div class="sect1">
<h2 id="via-leiningen"><a class="anchor" href="#via-leiningen"></a>Via Leiningen</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Use the convenient plugin for defaults, either in your project&#8217;s
<code>project.clj</code> file or in the <code>:user</code> profile in
<code>~/.lein/profiles.clj</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-clojure hljs" data-lang="clojure">:plugins [[cider/cider-nrepl "0.26.0"]]</code></pre>
</div>
</div>
<div class="paragraph">
<p>A minimal <code>profiles.clj</code> for CIDER would be:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-clojure hljs" data-lang="clojure">{:user {:plugins [[cider/cider-nrepl "0.26.0"]]}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Or (if you know what you&#8217;re doing) add <code>cider-nrepl</code> to your <code>:dev
:dependencies</code> vector plus specific middleware to <code>:nrepl-middleware</code>
under <code>:repl-options</code>.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-clojure hljs" data-lang="clojure">:dependencies [[cider/cider-nrepl "0.26.0"]]
:repl-options {:nrepl-middleware
                 [cider.nrepl/wrap-apropos
                  cider.nrepl/wrap-classpath
                  cider.nrepl/wrap-clojuredocs
                  cider.nrepl/wrap-complete
                  cider.nrepl/wrap-debug
                  cider.nrepl/wrap-format
                  cider.nrepl/wrap-info
                  cider.nrepl/wrap-inspect
                  cider.nrepl/wrap-macroexpand
                  cider.nrepl/wrap-ns
                  cider.nrepl/wrap-spec
                  cider.nrepl/wrap-profile
                  cider.nrepl/wrap-refresh
                  cider.nrepl/wrap-resource
                  cider.nrepl/wrap-stacktrace
                  cider.nrepl/wrap-test
                  cider.nrepl/wrap-trace
                  cider.nrepl/wrap-out
                  cider.nrepl/wrap-undef
                  cider.nrepl/wrap-version
                  cider.nrepl/wrap-xref]}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="via-boot"><a class="anchor" href="#via-boot"></a>Via Boot</h3>
<div class="paragraph">
<p>Boot users can configure the injected middleware by either specifying
it on the command line through the <code>cider.tasks/add-middleware</code> task
(the lenghty command below will include the <code>apropos</code> and <code>version</code>
functionality):</p>
</div>
<div class="listingblock">
<div class="content">
<pre>boot -d nrepl:0.7.0 -d cider/cider-nrepl:0.26.0 -i "(require 'cider.tasks)" cider.tasks/add-middleware -m cider.nrepl.middleware.apropos/wrap-apropos -m cider.nrepl.middleware.version/wrap-version repl --server wait</pre>
</div>
</div>
<div class="paragraph">
<p>Or for all of their projects by adding a <code>~/.boot/profile.boot</code> file like so:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-clojure hljs" data-lang="clojure">(set-env! :dependencies '[[nrepl "0.7.0"]
                          [cider/cider-nrepl "0.26.0"]])

(require '[cider.tasks :refer [add-middleware]])

(task-options! add-middleware {:middleware '[cider.nrepl.middleware.apropos/wrap-apropos
                                             cider.nrepl.middleware.version/wrap-version]})</code></pre>
</div>
</div>
<div class="paragraph">
<p>And then launching <code>boot add-middleware repl --server wait</code>.</p>
</div>
<div class="paragraph">
<p>Note that this is not necessary when using the standard <code>cider-jack-in</code>.</p>
</div>
<div class="paragraph">
<p>For more information visit <a href="https://github.com/boot-clj/boot/wiki/Cider-REPL">boot-clj wiki</a>.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="via-clj"><a class="anchor" href="#via-clj"></a>Via clj</h2>
<div class="sectionbody">
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<code>clj</code> was introduced in Clojure 1.9.
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>You can easily boot an nREPL server with the CIDER middleware loaded
with the following "magic" incantation:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>clj -Sdeps '{:deps {cider/cider-nrepl {:mvn/version "0.26.0"} }}' -m nrepl.cmdline --middleware "[cider.nrepl/cider-middleware]"</pre>
</div>
</div>
<div class="paragraph">
<p>There are also two convenient aliases you can employ:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-clojure hljs" data-lang="clojure">{...
 :aliases
 {:cider-clj {:extra-deps {org.clojure/clojure {:mvn/version "1.10.1"}
                           cider/cider-nrepl {:mvn/version "0.26.0"}}
              :main-opts ["-m" "nrepl.cmdline" "--middleware" "[cider.nrepl/cider-middleware]"]}

  :cider-cljs {:extra-deps {org.clojure/clojure {:mvn/version "1.10.1"}
                            org.clojure/clojurescript {:mvn/version "1.10.339"}
                            cider/cider-nrepl {:mvn/version "0.26.0"}
                            cider/piggieback {:mvn/version "0.5.2"}}
               :main-opts ["-m" "nrepl.cmdline" "--middleware"
                           "[cider.nrepl/cider-middleware,cider.piggieback/wrap-cljs-repl]"]}}}</code></pre>
</div>
</div>
<div class="paragraph">
<p>Which then allow you to simply run:</p>
</div>
<div class="listingblock">
<div class="content">
<pre>clj -A:cider-clj</pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="via-embedding-nrepl-in-your-application"><a class="anchor" href="#via-embedding-nrepl-in-your-application"></a>Via embedding nREPL in your application</h2>
<div class="sectionbody">
<div class="paragraph">
<p>If you&#8217;re embedding nREPL in your application you&#8217;ll have to start the
server with CIDER&#8217;s own nREPL handler.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-clojure hljs" data-lang="clojure">(ns my-app
  (:require [nrepl.server :as nrepl-server]
            [cider.nrepl :refer (cider-nrepl-handler)]))

(defn -main []
  (nrepl-server/start-server :port 7888 :handler cider-nrepl-handler))</code></pre>
</div>
</div>
<div class="paragraph">
<p>There&#8217;s nothing magical about the <code>cider-nrepl-handler</code> - all it does is
to add all middleware defined in <code>cider-nrepl</code> to nREPL&#8217;s default handler.
That&#8217;s how CIDER&#8217;s nREPL handler is created:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-clojure hljs" data-lang="clojure">(def cider-middleware
  '[cider.nrepl/wrap-apropos
    cider.nrepl/wrap-classpath
    cider.nrepl/wrap-clojuredocs
    cider.nrepl/wrap-complete
    cider.nrepl/wrap-content-type
    cider.nrepl/wrap-debug
    cider.nrepl/wrap-enlighten
    cider.nrepl/wrap-format
    cider.nrepl/wrap-info
    cider.nrepl/wrap-inspect
    cider.nrepl/wrap-macroexpand
    cider.nrepl/wrap-ns
    cider.nrepl/wrap-out
    cider.nrepl/wrap-slurp
    cider.nrepl/wrap-profile
    cider.nrepl/wrap-refresh
    cider.nrepl/wrap-resource
    cider.nrepl/wrap-spec
    cider.nrepl/wrap-stacktrace
    cider.nrepl/wrap-test
    cider.nrepl/wrap-trace
    cider.nrepl/wrap-tracker
    cider.nrepl/wrap-undef
    cider.nrepl/wrap-version
    cider.nrepl/wrap-xref])

(def cider-nrepl-handler
  "CIDER's nREPL handler."
  (apply nrepl-server/default-handler (map resolve-or-fail cider-middleware)))</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
You can build your own custom nREPL handler with the middleware you need by
adjusting the code above.
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect1">
<h2 id="with-jboss-asjboss-eapwildfly"><a class="anchor" href="#with-jboss-asjboss-eapwildfly"></a>With JBoss AS/JBoss EAP/WildFly</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Using the advanced features of the <code>info</code> middleware with one of the
JBoss application servers requires a tweak, since JBoss modules
prevent modifications to <code>AppClassLoader</code> (usually the highest
modifiable classloader) from being seen by application code. To work
around this, run the following code from within your application
to mark that classloader as unmodifiable, and cause the lower level
<code>clojure.lang.DynamicClassLoader</code> to be used instead. This code must
execute prior to loading the <code>cider-nrepl</code> middleware. Note that this
is only if you are deploying a standard WAR file to the application
server directly. If you are using <a href="http://immutant.org/">Immutant</a>
(1.x or 2.x), you won&#8217;t need to do this.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-clj hljs" data-lang="clj">(require '[dynapath.dynamic-classpath :as cp])

(extend sun.misc.Launcher$AppClassLoader
  cp/DynamicClasspath
  (assoc cp/base-readable-addable-classpath
    :classpath-urls #(seq (.getURLs %))
    :can-add? (constantly false)))</code></pre>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="index.html">Home</a></span>
  <span class="next"><a href="internals.html">Understanding the Internals</a></span>
</nav>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <p>Copyright (C) 2012-2022 <a href="https://batsov.com">Bozhidar Batsov</a> and <a href="https://cider.mx">CIDER</a> contributors.</p>
  <p>Except where otherwise noted, docs.cider.mx is licensed under the <a href="https://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution-ShareAlike 4.0 International</a> (CC BY-SA 4.0).</p>
</footer>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@docsearch/js@alpha"></script>
<script type="text/javascript">
 docsearch({
   appId: '1AZEMR3ZT0',
   apiKey: 'd2cfc21fce00ac9d3f787c0d8e064d42',
   indexName: 'cider',
   inputSelector: '#search-input',
   debug: false // Set debug to true if you want to inspect the dropdown
 });
</script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
